# üçï –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é —á–µ—Ä–µ–∑ PostgreSQL

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¢–µ–ø–µ—Ä—å –º–µ–Ω—é —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ PostgreSQL, –∞ –Ω–µ –≤ –∫–æ–¥–µ! –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ –ò–∑–º–µ–Ω—è—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ Hot-reload –º–µ–Ω—é —á–µ—Ä–µ–∑ API
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- ‚úÖ Zero Downtime –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–µ–Ω—é

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –¢–∞–±–ª–∏—Ü—ã

1. **pizza_recipes** - —Ä–µ—Ü–µ–ø—Ç—ã –ø–∏—Ü—Ü
   - `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∏—Ü—Ü—ã (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ)
   - `price` - —Ü–µ–Ω–∞ –≤ —Ä—É–±–ª—è—Ö
   - `ingredients` - JSON –º–∞—Å—Å–∏–≤ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤: `["—Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞", "–±–µ–∫–æ–Ω"]`
   - `ingredient_amounts` - JSON map –¥–æ–∑–∏—Ä–æ–≤–æ–∫: `{"—Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞": 150, "–±–µ–∫–æ–Ω": 80}`
   - `is_active` - –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –ø–∏—Ü—Ü–∞

2. **pizza_sets** - –Ω–∞–±–æ—Ä—ã –ø–∏—Ü—Ü
   - `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞
   - `description` - –æ–ø–∏—Å–∞–Ω–∏–µ
   - `pizzas` - JSON –º–∞—Å—Å–∏–≤ –Ω–∞–∑–≤–∞–Ω–∏–π –ø–∏—Ü—Ü: `["New York", "–°–æ–ª—è–Ω–∫–∞ –ó–ª–æ–¥–µ–π—Å–∫–∞—è"]`
   - `price` - –æ–±—â–∞—è —Ü–µ–Ω–∞ –Ω–∞–±–æ—Ä–∞

3. **extras** - –¥–æ–ø—ã
   - `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ
   - `price` - —Ü–µ–Ω–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ —Å PostgreSQL

```bash
docker-compose up -d
```

PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ–Ω—é —á–µ—Ä–µ–∑ SQL

```sql
-- –ò–∑–º–µ–Ω–∏—Ç—å –¥–æ–∑–∏—Ä–æ–≤–∫—É —Å—ã—Ä–∞ –≤ "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –∑–∞–≤—Ç—Ä–∞–∫" —Å 150–≥ –Ω–∞ 200–≥
UPDATE pizza_recipes 
SET ingredient_amounts = '{"—Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞": 200, "–±–µ–∫–æ–Ω": 80, "—è–π—Ü–æ": 100, "–ø–æ–º–∏–¥–æ—Ä—ã": 120, "–ª—É–∫": 60, "—Å–æ—É—Å": 80}'
WHERE name = '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –∑–∞–≤—Ç—Ä–∞–∫';

-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø–∏—Ü—Ü—É
INSERT INTO pizza_recipes (name, price, ingredients, ingredient_amounts) VALUES
('–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', 449,
 '["—Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞", "–ø–æ–º–∏–¥–æ—Ä—ã", "–±–∞–∑–∏–ª–∏–∫", "—Å–æ—É—Å"]',
 '{"—Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞": 150, "–ø–æ–º–∏–¥–æ—Ä—ã": 120, "–±–∞–∑–∏–ª–∏–∫": 10, "—Å–æ—É—Å": 80}');

-- –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É
UPDATE pizza_recipes SET price = 649 WHERE name = 'New York';
```

### 3. Hot-Reload –º–µ–Ω—é —á–µ—Ä–µ–∑ API

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î, –æ–±–Ω–æ–≤–∏ –º–µ–Ω—é –±–µ–∑ —Ä–µ—Å—Ç–∞—Ä—Ç–∞:

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é –∏–∑ –ë–î
curl -X POST http://localhost:8080/api/v1/admin/update-menu

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–µ–Ω—é
curl http://localhost:8080/api/v1/admin/menu-status
```

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –º–µ–Ω—é –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –∏–∑ –ë–î. –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ `menu_service.go`:

```go
updateInterval: 5 * time.Minute, // –ò–∑–º–µ–Ω–∏ –Ω–∞ –Ω—É–∂–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `migrations/001_init_menu.sql` –∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

## –í–∞–∂–Ω–æ!

- **–°—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞ –≤—Å–µ–≥–¥–∞ 150–≥** - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –Ω–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –ë–î
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **–±–µ–∑ —Ä–µ—Å—Ç–∞—Ä—Ç–∞** —Å–µ—Ä–≤–µ—Ä–∞
- In-memory –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –î–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π `/api/v1/admin/update-menu`

## –ü—Ä–∏–º–µ—Ä—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –≤ –ø–∏—Ü—Ü—É

```sql
-- –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
SELECT ingredients, ingredient_amounts FROM pizza_recipes WHERE name = '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è';

-- –û–±–Ω–æ–≤–∏—Ç—å (–¥–æ–±–∞–≤–∏—Ç—å "–æ–ª–∏–≤–∫–∏")
UPDATE pizza_recipes 
SET 
  ingredients = '["—Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞", "–ø–æ–º–∏–¥–æ—Ä—ã", "–±–∞–∑–∏–ª–∏–∫", "—Å–æ—É—Å", "–æ–ª–∏–≤–∫–∏"]',
  ingredient_amounts = '{"—Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞": 150, "–ø–æ–º–∏–¥–æ—Ä—ã": 120, "–±–∞–∑–∏–ª–∏–∫": 10, "—Å–æ—É—Å": 80, "–æ–ª–∏–≤–∫–∏": 50}'
WHERE name = '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è';
```

### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –Ω–∞–±–æ—Ä

```sql
INSERT INTO pizza_sets (name, description, pizzas, price) VALUES
('–í–µ—á–µ—Ä–∏–Ω–∫–∞', '4 –ø–∏—Ü—Ü—ã –¥–ª—è –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏',
 '["New York", "–°–æ–ª—è–Ω–∫–∞ –ó–ª–æ–¥–µ–π—Å–∫–∞—è", "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –∑–∞–≤—Ç—Ä–∞–∫", "–ú—è—Å–Ω–∞—è"]', 2500);
```

### –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Ü—Ü—É (—Å–∫—Ä—ã—Ç—å –∏–∑ –º–µ–Ω—é)

```sql
UPDATE pizza_recipes SET is_active = false WHERE name = '–û—Ö–æ—Ç–Ω–∏—á—å—è';
```

---

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å –º–µ–Ω—é —á–µ—Ä–µ–∑ SQL, –∏ —Å–µ—Ä–≤–µ—Ä –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –ª–µ—Ç—É! üöÄ**





