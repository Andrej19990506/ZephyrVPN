# –ê—É–¥–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–æ–±–∞–≤–æ–∫/–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (Extras/Add-ons)

**–î–∞—Ç–∞:** 2026-02-07  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–Ω—ã–π –∞—É–¥–∏—Ç  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üìã Executive Summary

–ü—Ä–æ–≤–µ–¥–µ–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –¥–æ–±–∞–≤–æ–∫/–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ ERP –¥–ª—è –ø–∏—Ü—Ü–µ—Ä–∏–π. –í—ã—è–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏, —Å–≤—è–∑—è—Ö –ë–î –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º—ã.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –í–´–°–û–ö–ê–Ø  
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

---

## üîç 1. –¶–ï–ù–û–û–ë–†–ê–ó–û–í–ê–ù–ò–ï (Food Cost)

### ‚ùå –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 1.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–≤—è–∑–∏ —Å –∑–∞–∫—É–ø–æ—á–Ω–æ–π —Ü–µ–Ω–æ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–ø—ã –∏–º–µ—é—Ç —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω—É (`extras.price`), –Ω–æ –Ω–µ—Ç —Å–≤—è–∑–∏ —Å:
- –ó–∞–∫—É–ø–æ—á–Ω–æ–π —Ü–µ–Ω–æ–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ (–∏–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö)
- –í–µ—Å–æ–º –ø–æ—Ä—Ü–∏–∏ –¥–æ–ø–∞
- –†–∞—Å—á–µ—Ç–æ–º —Ñ—É–¥-–∫–æ—Å—Ç–∞

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```sql
extras (
    id, name, price,  -- –¢–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞!
    nomenclature_id,   -- –ï—Å—Ç—å —Å–≤—è–∑—å, –Ω–æ –Ω–µ—Ç –≤–µ—Å–∞ –ø–æ—Ä—Ü–∏–∏
    recipe_id
)
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ü–µ–Ω—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–∫—É–ø–æ—á–Ω–æ–π —Ü–µ–Ω—ã
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ–ø–æ–≤
- ‚ùå –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –º–∞—Ä–∂–µ (< 30%)

#### 1.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–µ—Å–∞ –ø–æ—Ä—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø–æ–ª—è `portion_weight` –∏–ª–∏ `portion_size` –¥–ª—è –¥–æ–ø–æ–≤.

**–ü—Ä–∏–º–µ—Ä:**
- "–î–æ–ø. —Å—ã—Ä" = 50–≥ —Å—ã—Ä–∞
- "–î–≤–æ–π–Ω–æ–π —Å—ã—Ä" = 100–≥ —Å—ã—Ä–∞
- –ù–æ –≤ –ë–î –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ—Å–µ!

#### 1.3. –ù–µ—Ç —Ä–∞—Å—á–µ—Ç–∞ —Ñ—É–¥-–∫–æ—Å—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞:
```
Food Cost = (–ó–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ / –í–µ—Å —É–ø–∞–∫–æ–≤–∫–∏) √ó –í–µ—Å –ø–æ—Ä—Ü–∏–∏ –¥–æ–ø–∞
–ú–∞—Ä–∂–∞ = (–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ - Food Cost) / –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ √ó 100%
```

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

#### –†–µ—à–µ–Ω–∏–µ 1.1: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã extras –¥–ª—è —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
ALTER TABLE extras ADD COLUMN IF NOT EXISTS portion_weight_grams INTEGER; -- –í–µ—Å –ø–æ—Ä—Ü–∏–∏ –≤ –≥—Ä–∞–º–º–∞—Ö
ALTER TABLE extras ADD COLUMN IF NOT EXISTS food_cost_per_unit DECIMAL(10,2); -- –§—É–¥-–∫–æ—Å—Ç –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
ALTER TABLE extras ADD COLUMN IF NOT EXISTS margin_percent DECIMAL(5,2); -- –ú–∞—Ä–∂–∞ –≤ % (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
ALTER TABLE extras ADD COLUMN IF NOT EXISTS min_margin_percent DECIMAL(5,2) DEFAULT 30.0; -- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–∞—Ä–∂–∞ (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
```

#### –†–µ—à–µ–Ω–∏–µ 1.2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ñ—É–¥-–∫–æ—Å—Ç–∞

**–î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –¥–æ–ø–æ–≤ (nomenclature_id):**
```go
// –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–æ–ø–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–∫—É–ø–æ—á–Ω–æ–π —Ü–µ–Ω—ã
func CalculateExtraFoodCost(extra *ExtraDB, nomenclature *NomenclatureItem) {
    // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–∫—É–ø–æ—á–Ω—É—é —Ü–µ–Ω—É –∏–∑ stock_batches
    // StockBatch.CostPerUnit - –∑–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
    // NomenclatureItem.UnitWeight - –≤–µ—Å –µ–¥–∏–Ω–∏—Ü—ã –≤ –≥—Ä–∞–º–º–∞—Ö (–¥–ª—è pcs, box)
    // NomenclatureItem.BaseUnit - –±–∞–∑–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞ (kg, l, pcs, box)
    
    var purchasePricePerGram float64
    
    if nomenclature.BaseUnit == "kg" || nomenclature.BaseUnit == "l" {
        // –î–ª—è –≤–µ—Å–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤: –ø–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É –∏–∑ StockBatch
        var latestBatch StockBatch
        db.Where("nomenclature_id = ?", nomenclature.ID).
           Order("created_at DESC").
           First(&latestBatch)
        
        // –¶–µ–Ω–∞ –∑–∞ –∫–≥/–ª
        pricePerBaseUnit := latestBatch.CostPerUnit
        
        // –¶–µ–Ω–∞ –∑–∞ –≥—Ä–∞–º–º
        purchasePricePerGram = pricePerBaseUnit / 1000.0 // 1–∫–≥ = 1000–≥
    } else if nomenclature.BaseUnit == "pcs" || nomenclature.BaseUnit == "box" {
        // –î–ª—è —à—Ç—É—á–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        var latestBatch StockBatch
        db.Where("nomenclature_id = ?", nomenclature.ID).
           Order("created_at DESC").
           First(&latestBatch)
        
        // –¶–µ–Ω–∞ –∑–∞ —à—Ç—É–∫—É
        pricePerPiece := latestBatch.CostPerUnit
        
        // –í–µ—Å –æ–¥–Ω–æ–π —à—Ç—É–∫–∏ –≤ –≥—Ä–∞–º–º–∞—Ö
        pieceWeight := nomenclature.UnitWeight // –≥—Ä–∞–º–º—ã
        
        // –¶–µ–Ω–∞ –∑–∞ –≥—Ä–∞–º–º
        purchasePricePerGram = pricePerPiece / pieceWeight
    }
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ—É–¥-–∫–æ—Å—Ç –¥–ª—è –ø–æ—Ä—Ü–∏–∏ –¥–æ–ø–∞
    extra.FoodCostPerUnit = purchasePricePerGram * float64(extra.PortionWeightGrams)
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ä–∂—É
    extra.MarginPercent = ((float64(extra.Price) - extra.FoodCostPerUnit) / float64(extra.Price)) * 100
    
    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –º–∞—Ä–∂–∞ –Ω–∏–∑–∫–∞—è
    if extra.MarginPercent < extra.MinMarginPercent {
        log.Warnf("‚ö†Ô∏è –ù–∏–∑–∫–∞—è –º–∞—Ä–∂–∞ –¥–ª—è –¥–æ–ø–∞ '%s': %.2f%% (–º–∏–Ω–∏–º—É–º: %.2f%%)", 
            extra.Name, extra.MarginPercent, extra.MinMarginPercent)
    }
}
```

**–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–æ–ø–æ–≤ (recipe_id):**
```go
// BOM Explosion - —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞
func CalculateExtraFoodCostFromRecipe(extra *ExtraDB, recipe *Recipe) {
    totalFoodCost := 0.0
    
    for _, ingredient := range recipe.Ingredients {
        if ingredient.NomenclatureID != nil {
            nom := GetNomenclature(*ingredient.NomenclatureID)
            purchasePrice := GetLatestPurchasePrice(nom.ID)
            packageWeight := nom.Weight
            
            // –í–µ—Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ –≤ —Ä–µ—Ü–µ–ø—Ç–µ
            ingredientWeight := ingredient.AmountGrams
            
            // –§—É–¥-–∫–æ—Å—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
            ingredientCost := (purchasePrice / packageWeight) * ingredientWeight
            totalFoodCost += ingredientCost
        }
    }
    
    extra.FoodCostPerUnit = totalFoodCost
    extra.MarginPercent = ((float64(extra.Price) - totalFoodCost) / float64(extra.Price)) * 100
}
```

#### –†–µ—à–µ–Ω–∏–µ 1.3: –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞

```sql
-- –¢—Ä–∏–≥–≥–µ—Ä: –ü–µ—Ä–µ—Å—á–µ—Ç —Ñ—É–¥-–∫–æ—Å—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–∫—É–ø–æ—á–Ω–æ–π —Ü–µ–Ω—ã
CREATE OR REPLACE FUNCTION recalculate_extras_food_cost()
RETURNS TRIGGER AS $$
BEGIN
    -- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ—É–¥-–∫–æ—Å—Ç –¥–ª—è –≤—Å–µ—Ö –¥–æ–ø–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö —ç—Ç—É –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—É
    UPDATE extras e
    SET 
        food_cost_per_unit = (
            SELECT (NEW.purchase_price / n.weight) * e.portion_weight_grams
            FROM nomenclature_items n
            WHERE n.id = e.nomenclature_id
        ),
        margin_percent = (
            SELECT ((e.price::decimal - food_cost_per_unit) / e.price::decimal) * 100
        )
    WHERE e.nomenclature_id = NEW.nomenclature_id;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_recalculate_extras_on_price_change
AFTER UPDATE OF purchase_price ON stock_batches
FOR EACH ROW
EXECUTE FUNCTION recalculate_extras_food_cost();
```

---

## üîó 2. –°–í–Ø–ó–ò –í –ë–î (–ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ)

### ‚ùå –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 2.1. –ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–∏—Ü—Ü
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–≤—è–∑—å `pizza_extras` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∏—Ü—Ü—ã:
```sql
pizza_extras (
    pizza_name VARCHAR(255),  -- –¢–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!
    extra_id INTEGER
)
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –º–∞—Å—Å–æ–≤–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –¥–æ–ø—ã "–≤—Å–µ–º –ø–∏—Ü—Ü–∞–º 30—Å–º"
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –¥–æ–ø—ã "–≤—Å–µ–º –ø–∏—Ü—Ü–∞–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ'"
- ‚ùå –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –ø–∏—Ü—Ü—ã –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å –¥–æ–ø—ã

#### 2.2. –ù–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:
- –ü–æ —Ä–∞–∑–º–µ—Ä—É: 30—Å–º, 35—Å–º, 40—Å–º
- –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ, –û—Å—Ç—Ä—ã–µ, –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∏–µ
- –ü–æ —Ç–∏–ø—É —Ç–µ—Å—Ç–∞: –¢–æ–Ω–∫–æ–µ, –¢–æ–ª—Å—Ç–æ–µ

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

#### –†–µ—à–µ–Ω–∏–µ 2.1: –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∏—Ü—Ü

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–∏—Ü—Ü
CREATE TABLE IF NOT EXISTS pizza_categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE, -- "30—Å–º", "35—Å–º", "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ"
    type VARCHAR(50) NOT NULL, -- "size", "category", "dough_type"
    parent_id INTEGER REFERENCES pizza_categories(id), -- –ò–µ—Ä–∞—Ä—Ö–∏—è
    created_at TIMESTAMP DEFAULT NOW()
);

-- –°–≤—è–∑—å –ø–∏—Ü—Ü —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
CREATE TABLE IF NOT EXISTS pizza_category_assignments (
    pizza_name VARCHAR(255) NOT NULL REFERENCES pizza_recipes(name) ON DELETE CASCADE,
    category_id INTEGER NOT NULL REFERENCES pizza_categories(id) ON DELETE CASCADE,
    PRIMARY KEY (pizza_name, category_id)
);

-- –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ø–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
CREATE TABLE IF NOT EXISTS category_extras (
    category_id INTEGER NOT NULL REFERENCES pizza_categories(id) ON DELETE CASCADE,
    extra_id INTEGER NOT NULL REFERENCES extras(id) ON DELETE CASCADE,
    is_default BOOLEAN DEFAULT false,
    display_order INTEGER DEFAULT 0,
    PRIMARY KEY (category_id, extra_id)
);
```

#### –†–µ—à–µ–Ω–∏–µ 2.2: –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–æ–ø–æ–≤

```go
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–æ–ø—ã –¥–ª—è –ø–∏—Ü—Ü—ã (—Å —É—á–µ—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
func GetAvailableExtrasForPizza(pizzaName string) []Extra {
    var extras []Extra
    
    // 1. –î–æ–ø—ã, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∫ –ø–∏—Ü—Ü–µ
    db.Where("pizza_name = ?", pizzaName).
       Preload("Extra").
       Find(&pizzaExtras)
    
    // 2. –î–æ–ø—ã, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ø–∏—Ü—Ü—ã
    var categoryIDs []int
    db.Table("pizza_category_assignments").
       Where("pizza_name = ?", pizzaName).
       Pluck("category_id", &categoryIDs)
    
    var categoryExtras []CategoryExtra
    db.Where("category_id IN ?", categoryIDs).
       Preload("Extra").
       Find(&categoryExtras)
    
    // 3. –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏ —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    extrasMap := make(map[int]Extra)
    for _, pe := range pizzaExtras {
        extrasMap[pe.ExtraID] = pe.Extra
    }
    for _, ce := range categoryExtras {
        extrasMap[ce.ExtraID] = ce.Extra
    }
    
    // 4. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Å–ª–∞–π—Å
    result := make([]Extra, 0, len(extrasMap))
    for _, extra := range extrasMap {
        result = append(result, extra)
    }
    
    return result
}
```

#### –†–µ—à–µ–Ω–∏–µ 2.3: UI –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

```svelte
<!-- –í ExtrasManagement.svelte -->
<div class="mb-6">
  <h3 class="text-lg font-semibold mb-4">–ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ø–æ–≤</h3>
  
  <!-- –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
  <select bind:value={selectedCategory}>
    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
    <option value="size:30">–í—Å–µ –ø–∏—Ü—Ü—ã 30—Å–º</option>
    <option value="size:35">–í—Å–µ –ø–∏—Ü—Ü—ã 35—Å–º</option>
    <option value="category:classic">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –ø–∏—Ü—Ü—ã</option>
  </select>
  
  <!-- –°–ø–∏—Å–æ–∫ –¥–æ–ø–æ–≤ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è -->
  <div class="mt-4">
    {#each extras as extra}
      <label class="flex items-center gap-2">
        <input type="checkbox" bind:group={selectedExtrasForCategory} value={extra.id} />
        <span>{extra.name} - {formatPrice(extra.price)}</span>
      </label>
    {/each}
  </div>
  
  <button on:click={assignExtrasToCategory}>
    –ù–∞–∑–Ω–∞—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–æ–ø—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  </button>
</div>
```

---

## üõ°Ô∏è 3. –í–ê–õ–ò–î–ê–¶–ò–Ø –ó–ê–ö–ê–ó–û–í

### ‚ùå –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 3.1. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –∏–º–µ–Ω–∏ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–ø—ã –∏—â—É—Ç—Å—è –ø–æ –∏–º–µ–Ω–∏:
```go
extra, exists := models.GetExtra(extraName) // –ü–æ –∏–º–µ–Ω–∏!
```

**–£—è–∑–≤–∏–º–æ—Å—Ç–∏:**
- ‚ùå –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ª—é–±–æ–µ –∏–º—è –¥–æ–ø–∞
- ‚ùå –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —É–∫–∞–∑–∞—Ç—å —Ü–µ–Ω—É –¥–æ–ø–∞ –≤—Ä—É—á–Ω—É—é
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –¥–æ–ø –¥–ª—è —ç—Ç–æ–π –ø–∏—Ü—Ü—ã

#### 3.2. –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–ø–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `order_controller.go` –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
```go
// –¢–µ–∫—É—â–∏–π –∫–æ–¥ (–ù–ï–ë–ï–ó–û–ü–ê–°–ù–û):
for _, extraName := range item.Extras {
    extra, exists := models.GetExtra(extraName)
    if exists {
        extrasPrice += extra.Price // –ë–µ—Ä–µ–º —Ü–µ–Ω—É –∏–∑ –º–µ–Ω—é - —Ö–æ—Ä–æ—à–æ
    }
    // –ù–û: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ —ç—Ç–æ—Ç –¥–æ–ø –¥–ª—è item.PizzaName!
}
```

#### 3.3. –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ü–µ–Ω—É
**–ü—Ä–æ–±–ª–µ–º–∞:** –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å:
```json
{
  "pizza_name": "–ü–∏—Ü—Ü–∞ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è",
  "extras": ["–î–æ–ø. —Å—ã—Ä"],
  "price": 9999  // –ö–ª–∏–µ–Ω—Ç –ø–æ–¥—Å—Ç–∞–≤–∏–ª —Å–≤–æ—é —Ü–µ–Ω—É!
}
```

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

#### –†–µ—à–µ–Ω–∏–µ 3.1: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ ID, –∞ –Ω–µ –ø–æ –∏–º–µ–Ω–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏:**
```go
type PizzaItem struct {
    PizzaName   string   `json:"pizza_name"`
    Extras      []int    `json:"extras"` // ID –¥–æ–ø–æ–≤, –∞ –Ω–µ –∏–º–µ–Ω–∞!
    // ...
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ:**
```go
func (oc *OrderController) CreateOrder(c *gin.Context) {
    // ...
    
    // 1. –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–ø—ã –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∏—Ü—Ü—ã
    allowedExtras := GetAvailableExtrasForPizza(item.PizzaName)
    allowedExtraIDs := make(map[int]bool)
    for _, extra := range allowedExtras {
        allowedExtraIDs[extra.ID] = true
    }
    
    // 2. –í–∞–ª–∏–¥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –¥–æ–ø
    extrasPrice := 0
    for _, extraID := range item.Extras {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –¥–æ–ø –¥–ª—è —ç—Ç–æ–π –ø–∏—Ü—Ü—ã
        if !allowedExtraIDs[extraID] {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": fmt.Sprintf("–î–æ–ø —Å ID %d –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –ø–∏—Ü—Ü—ã '%s'", extraID, item.PizzaName),
            })
            return
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–æ–ø –ø–æ ID (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
        extra, exists := models.GetExtraByID(extraID)
        if !exists {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": fmt.Sprintf("–î–æ–ø —Å ID %d –Ω–µ –Ω–∞–π–¥–µ–Ω", extraID),
            })
            return
        }
        
        extrasPrice += extra.Price // –¶–µ–Ω–∞ –¢–û–õ–¨–ö–û –∏–∑ –ë–î!
    }
    
    // 3. –ü–ï–†–ï–°–ß–ò–¢–´–í–ê–ï–ú —Ü–µ–Ω—É –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ü–µ–Ω—É –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞)
    pizza, _ := models.GetPizza(item.PizzaName)
    calculatedPrice := pizza.Price + extrasPrice
    
    // 4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å —Ü–µ–Ω–æ–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if item.Price > 0 && item.Price != calculatedPrice {
        log.Warnf("‚ö†Ô∏è –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω—ã –¥–ª—è '%s': –∫–ª–∏–µ–Ω—Ç=%d, —Ä–∞—Å—á–µ—Ç=%d", 
            item.PizzaName, item.Price, calculatedPrice)
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—á–µ—Ç–Ω—É—é —Ü–µ–Ω—É (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
    }
    
    items[i].Price = calculatedPrice
    items[i].PizzaPrice = pizza.Price
    items[i].ExtrasPrice = extrasPrice
}
```

#### –†–µ—à–µ–Ω–∏–µ 3.2: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ GetExtraByID

```go
// –í models/pizza.go
var AvailableExtrasByID = make(map[int]Extra) // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ ID

func GetExtraByID(id int) (Extra, bool) {
    extrasMu.RLock()
    defer extrasMu.RUnlock()
    extra, ok := AvailableExtrasByID[id]
    return extra, ok
}

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–µ–Ω—é –∑–∞–ø–æ–ª–Ω—è–µ–º –æ–±–∞ –∏–Ω–¥–µ–∫—Å–∞
func SetExtras(extrasMap map[string]Extra) {
    extrasMu.Lock()
    defer extrasMu.Unlock()
    
    AvailableExtras = extrasMap
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å –ø–æ ID
    AvailableExtrasByID = make(map[int]Extra)
    for _, extra := range extrasMap {
        if extra.ID > 0 {
            AvailableExtrasByID[int(extra.ID)] = extra
        }
    }
}
```

#### –†–µ—à–µ–Ω–∏–µ 3.3: –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞

```go
// –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞ —Å –¥–æ–ø–∞–º–∏
func ValidateOrderWithExtras(items []PizzaItem) error {
    for _, item := range items {
        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–∏—Ü—Ü—ã
        pizza, exists := models.GetPizza(item.PizzaName)
        if !exists {
            return fmt.Errorf("–ø–∏—Ü—Ü–∞ '%s' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞", item.PizzaName)
        }
        
        // 2. –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–ø—ã –¥–ª—è –ø–∏—Ü—Ü—ã
        allowedExtras := GetAvailableExtrasForPizza(item.PizzaName)
        allowedExtraIDs := make(map[int]bool)
        for _, extra := range allowedExtras {
            allowedExtraIDs[int(extra.ID)] = true
        }
        
        // 3. –í–∞–ª–∏–¥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –¥–æ–ø
        for _, extraID := range item.Extras {
            if !allowedExtraIDs[extraID] {
                return fmt.Errorf("–¥–æ–ø —Å ID %d –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –ø–∏—Ü—Ü—ã '%s'", extraID, item.PizzaName)
            }
            
            extra, exists := models.GetExtraByID(extraID)
            if !exists {
                return fmt.Errorf("–¥–æ–ø —Å ID %d –Ω–µ –Ω–∞–π–¥–µ–Ω", extraID)
            }
            
            if !extra.IsActive {
                return fmt.Errorf("–¥–æ–ø '%s' –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω", extra.Name)
            }
        }
        
        // 4. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—É (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ü–µ–Ω—É –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞)
        calculatedPrice := pizza.Price
        for _, extraID := range item.Extras {
            extra, _ := models.GetExtraByID(extraID)
            calculatedPrice += extra.Price
        }
        
        // 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ü–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—á–µ—Ç–Ω—É—é)
        if item.Price > 0 && item.Price != calculatedPrice {
            log.Warnf("‚ö†Ô∏è –¶–µ–Ω–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –¥–ª—è '%s': –∫–ª–∏–µ–Ω—Ç=%d, —Ä–∞—Å—á–µ—Ç=%d", 
                item.PizzaName, item.Price, calculatedPrice)
            // –ú–æ–∂–Ω–æ –ª–∏–±–æ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–∫–∞–∑, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç–Ω—É—é —Ü–µ–Ω—É
        }
    }
    
    return nil
}
```

---

## üìä 4. –ü–†–ò–û–†–ò–¢–ï–¢–´ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (Phase 0):

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ ID** (–Ω–µ –ø–æ –∏–º–µ–Ω–∏)
   - **–†–∏—Å–∫:** –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ü–µ–Ω—É –∏–ª–∏ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –¥–æ–ø
   - **–£—Å–∏–ª–∏–µ:** S (2-3 –¥–Ω—è)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∑–∞–∫–∞–∑–æ–≤

2. **–ü–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ**
   - **–†–∏—Å–∫:** –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ü–µ–Ω—É
   - **–£—Å–∏–ª–∏–µ:** S (1 –¥–µ–Ω—å)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –§–∏–Ω–∞–Ω—Å–æ–≤—É—é —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

### üü° –í–∞–∂–Ω–æ (Phase 1):

3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Å–∞ –ø–æ—Ä—Ü–∏–∏ –∏ —Ñ—É–¥-–∫–æ—Å—Ç–∞**
   - **–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - **–£—Å–∏–ª–∏–µ:** M (3-5 –¥–Ω–µ–π)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –ê–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏

4. **–ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ø–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º**
   - **–†–∏—Å–∫:** –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Ç–µ—Ö–Ω–æ–ª–æ–≥–∞
   - **–£—Å–∏–ª–∏–µ:** M (3-5 –¥–Ω–µ–π)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (Phase 2):

5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —Ñ—É–¥-–∫–æ—Å—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω**
   - **–£—Å–∏–ª–∏–µ:** S (2 –¥–Ω—è)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

6. **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–∏–∑–∫–æ–π –º–∞—Ä–∂–µ**
   - **–£—Å–∏–ª–∏–µ:** S (1 –¥–µ–Ω—å)
   - **–ë–ª–æ–∫–∏—Ä—É–µ—Ç:** –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏

---

## üéØ 5. –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –ù–µ–¥–µ–ª—è 1: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å `PizzaItem.Extras` —Å `[]string` –Ω–∞ `[]int` (ID –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω)
- [ ] –î–æ–±–∞–≤–∏—Ç—å `GetExtraByID()` –º–µ—Ç–æ–¥
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–ø–æ–≤
- [ ] –ü–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–Ω—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—É –∫–ª–∏–µ–Ω—Ç–∞)

### –ù–µ–¥–µ–ª—è 2: –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å `portion_weight_grams` –≤ `extras`
- [ ] –î–æ–±–∞–≤–∏—Ç—å `food_cost_per_unit` –∏ `margin_percent`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç —Ñ—É–¥-–∫–æ—Å—Ç–∞ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –¥–æ–ø–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç —Ñ—É–¥-–∫–æ—Å—Ç–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–æ–ø–æ–≤ (BOM)

### –ù–µ–¥–µ–ª—è 3: –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã `pizza_categories` –∏ `category_extras`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GetAvailableExtrasForPizza()` —Å —É—á–µ—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ø–æ–≤

### –ù–µ–¥–µ–ª—è 4: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- [ ] –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Ñ—É–¥-–∫–æ—Å—Ç–∞
- [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–∏–∑–∫–æ–π –º–∞—Ä–∂–µ
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —Å–ø–∏—Å–∞–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

---

## üìù 6. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### 6.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

```sql
-- –î–æ–ø—ã —Å —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º
extras (
    id,
    name,
    price,                    -- –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
    portion_weight_grams,     -- –í–µ—Å –ø–æ—Ä—Ü–∏–∏ (50–≥, 100–≥)
    nomenclature_id,          -- –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –¥–æ–ø–æ–≤
    recipe_id,                -- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–æ–ø–æ–≤ (BOM)
    food_cost_per_unit,       -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç
    margin_percent,           -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç
    min_margin_percent,       -- –ú–∏–Ω–∏–º—É–º –º–∞—Ä–∂–∏ (30%)
    is_active
)

-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∏—Ü—Ü
pizza_categories (
    id,
    name,                     -- "30—Å–º", "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ"
    type,                     -- "size", "category", "dough_type"
    parent_id                 -- –ò–µ—Ä–∞—Ä—Ö–∏—è
)

-- –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ø–æ–≤
category_extras (
    category_id,
    extra_id,
    is_default,
    display_order
)
```

### 6.2. API –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–∫–∞–∑–∞:**
```json
{
  "items": [{
    "pizza_name": "–ü–∏—Ü—Ü–∞ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è",
    "extras": ["–î–æ–ø. —Å—ã—Ä", "–•–∞–ª–∞–ø–µ–Ω—å–æ"],  // ‚ùå –ü–æ –∏–º–µ–Ω–∏
    "price": 500                            // ‚ùå –û—Ç –∫–ª–∏–µ–Ω—Ç–∞
  }]
}
```

**–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π):**
```json
{
  "items": [{
    "pizza_name": "–ü–∏—Ü—Ü–∞ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è",
    "extras": [1, 5],  // ‚úÖ –ü–æ ID
    "price": 0         // ‚úÖ –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
  }]
}
```

---

## üî¨ 7. –ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ì–û –ö–û–î–ê

### 7.1. –¢–µ–∫—É—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ø–æ–≤ (order_controller.go:86-94)

```go
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
for _, extraName := range item.Extras {
    extra, exists := models.GetExtra(extraName) // –ü–æ –∏–º–µ–Ω–∏!
    if exists {
        extrasPrice += extra.Price
    } else {
        log.Printf("   ‚ùå –î–æ–ø '%s' –ù–ï –Ω–∞–π–¥–µ–Ω –≤ –º–µ–Ω—é!", extraName)
        // ‚ùå –ù–û: –∑–∞–∫–∞–∑ –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è! –ù–µ—Ç return –∏–ª–∏ –æ—à–∏–±–∫–∏!
    }
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. ‚ùå –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ - –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ª—é–±–æ–µ –∏–º—è
2. ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–ø–æ–≤ –¥–ª—è –ø–∏—Ü—Ü—ã
3. ‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ –¥–æ–ø –Ω–µ –Ω–∞–π–¥–µ–Ω
4. ‚ùå –¶–µ–Ω–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –º–µ–Ω—é (—Ö–æ—Ä–æ—à–æ), –Ω–æ –Ω–µ—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

### 7.2. –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ExtraDB

```go
type ExtraDB struct {
    ID            uint    `gorm:"primaryKey"`
    Name          string  `gorm:"uniqueIndex:name;not null"`
    Price         int     `gorm:"not null"` // –¢–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞!
    NomenclatureID *string `gorm:"type:uuid;index"` // ‚úÖ –ï—Å—Ç—å —Å–≤—è–∑—å
    RecipeID      *string `gorm:"type:uuid;index"` // ‚úÖ –ï—Å—Ç—å —Å–≤—è–∑—å
    // ‚ùå –ù–ï–¢: portion_weight_grams
    // ‚ùå –ù–ï–¢: food_cost_per_unit
    // ‚ùå –ù–ï–¢: margin_percent
}
```

### 7.3. –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ PizzaItem

```go
type PizzaItem struct {
    PizzaName   string   `json:"pizza_name"`
    Extras      []string `json:"extras,omitempty"` // ‚ùå –ü–æ –∏–º–µ–Ω–∏, –Ω–µ –ø–æ ID!
    Price       int      `json:"price"` // ‚ùå –û—Ç –∫–ª–∏–µ–Ω—Ç–∞, –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è!
    // ...
}
```

### 7.4. –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ñ—É–¥-–∫–æ—Å—Ç–∞

**–í —Å–∏—Å—Ç–µ–º–µ —É–∂–µ –µ—Å—Ç—å:**
- ‚úÖ `StockBatch.CostPerUnit` - –∑–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞ –∏–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö
- ‚úÖ `NomenclatureItem.UnitWeight` - –≤–µ—Å –µ–¥–∏–Ω–∏—Ü—ã –≤ –≥—Ä–∞–º–º–∞—Ö
- ‚úÖ `NomenclatureItem.BaseUnit` - –±–∞–∑–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞ (kg, l, pcs, box)
- ‚úÖ `RecipeIngredient.AmountGrams` - –≤–µ—Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ –≤ —Ä–µ—Ü–µ–ø—Ç–µ

**–ß–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç:**
- ‚ùå `ExtraDB.PortionWeightGrams` - –≤–µ—Å –ø–æ—Ä—Ü–∏–∏ –¥–æ–ø–∞
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Ñ—É–¥-–∫–æ—Å—Ç–∞
- ‚ùå –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–≤ –∏–º–µ–µ—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –∏ **–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–≤—è–∑–∏ —Å —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º**. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ ID –∏ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Ü–µ–Ω –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (Phase 0), –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–¥-–∫–æ—Å—Ç–∞ –∏ –º–∞—Å—Å–æ–≤–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (Phase 1).

**–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤:**
- üî¥ **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏:** –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ü–µ–Ω—É ‚Üí –ø–æ—Ç–µ—Ä—è –ø—Ä–∏–±—ã–ª–∏
- üî¥ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –¥–æ–ø ‚Üí –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º
- üü° **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—Å–æ–≤–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è ‚Üí –ø–æ—Ç–µ—Ä—è –≤—Ä–µ–º–µ–Ω–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∞
- üü° **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ—É–¥-–∫–æ—Å—Ç–∞ ‚Üí –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** Phase 0 ‚Üí Phase 1 ‚Üí Phase 2

---

## üìé –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### A. –ü—Ä–∏–º–µ—Ä—ã —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

**–£—è–∑–≤–∏–º–æ—Å—Ç—å 1: –ü–æ–¥–º–µ–Ω–∞ —Ü–µ–Ω—ã**
```json
// –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
{
  "pizza_name": "–ü–∏—Ü—Ü–∞ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è",
  "extras": ["–î–æ–ø. —Å—ã—Ä"],
  "price": 1  // ‚ùå –ü–æ–¥—Å—Ç–∞–≤–∏–ª —Ü–µ–Ω—É 1‚ÇΩ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π!
}
// –ë—ç–∫–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç—É —Ü–µ–Ω—É –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
```

**–£—è–∑–≤–∏–º–æ—Å—Ç—å 2: –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –¥–æ–ø**
```json
// –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
{
  "pizza_name": "–ü–∏—Ü—Ü–∞ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è",
  "extras": ["–ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç"]  // ‚ùå –î–æ–ø –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è —ç—Ç–æ–π –ø–∏—Ü—Ü—ã!
}
// –ë—ç–∫–µ–Ω–¥ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–ø—ã
```

**–£—è–∑–≤–∏–º–æ—Å—Ç—å 3: –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–ø**
```json
// –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
{
  "pizza_name": "–ü–∏—Ü—Ü–∞ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è",
  "extras": ["–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–æ–ø"]  // ‚ùå –î–æ–ø –Ω–µ –Ω–∞–π–¥–µ–Ω
}
// –ë—ç–∫–µ–Ω–¥ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É, –Ω–æ –∑–∞–∫–∞–∑ –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è!
```

### B. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

| –ê—Å–ø–µ–∫—Ç | –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è | –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ |
|--------|-------------------|-------------------|
| –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ø–æ–≤ | –ü–æ –∏–º–µ–Ω–∏ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ) | –ü–æ ID (–±–µ–∑–æ–ø–∞—Å–Ω–æ) |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö | ‚ùå –ù–µ—Ç | ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ pizza_extras |
| –ü–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–Ω—ã | ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ü–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ | ‚úÖ –ü–µ—Ä–µ—Å—á–µ—Ç –Ω–∞ –±—ç–∫–µ–Ω–¥–µ |
| –§—É–¥-–∫–æ—Å—Ç | ‚ùå –ù–µ—Ç | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç |
| –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ | ‚ùå –ù–µ—Ç | ‚úÖ –ß–µ—Ä–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| –ú–∞—Ä–∂–∞ | ‚ùå –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç + –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è |

### C. SQL –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
1. `018_add_nomenclature_to_extras.sql` - —Å–≤—è–∑—å —Å –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–æ–π ‚úÖ (—Å–æ–∑–¥–∞–Ω–∞)
2. `019_add_food_cost_to_extras.sql` - —Ñ—É–¥-–∫–æ—Å—Ç –∏ –º–∞—Ä–∂–∞ (–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å)
3. `020_add_pizza_categories.sql` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å)

